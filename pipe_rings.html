<html><head><title>niplav</title>
<link href="./favicon.png" rel="shortcut icon" type="image/png">
<link href="main.css" rel="stylesheet" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">


<style type="text/css">
code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
</style>
<script>
document.addEventListener('DOMContentLoaded', function () {
	// Change the title to the h1 header
	var title = document.querySelector('h1')
	if(title) {
		var title_elem = document.querySelector('title')
		title_elem.textContent=title.textContent + " – niplav"
	}
});
</script>
<style type="text/css">
                            .mjpage .MJX-monospace {
                            font-family: monospace
                            }

                            .mjpage .MJX-sans-serif {
                            font-family: sans-serif
                            }

                            .mjpage {
                            display: inline;
                            font-style: normal;
                            font-weight: normal;
                            line-height: normal;
                            font-size: 100%;
                            font-size-adjust: none;
                            text-indent: 0;
                            text-align: left;
                            text-transform: none;
                            letter-spacing: normal;
                            word-spacing: normal;
                            word-wrap: normal;
                            white-space: nowrap;
                            float: none;
                            direction: ltr;
                            max-width: none;
                            max-height: none;
                            min-width: 0;
                            min-height: 0;
                            border: 0;
                            padding: 0;
                            margin: 0
                            }

                            .mjpage * {
                            transition: none;
                            -webkit-transition: none;
                            -moz-transition: none;
                            -ms-transition: none;
                            -o-transition: none
                            }

                            .mjx-svg-href {
                            fill: blue;
                            stroke: blue
                            }

                            .MathJax_SVG_LineBox {
                            display: table!important
                            }

                            .MathJax_SVG_LineBox span {
                            display: table-cell!important;
                            width: 10000em!important;
                            min-width: 0;
                            max-width: none;
                            padding: 0;
                            border: 0;
                            margin: 0
                            }

                            .mjpage__block {
                            text-align: center;
                            margin: 1em 0em;
                            position: relative;
                            display: block!important;
                            text-indent: 0;
                            max-width: none;
                            max-height: none;
                            min-width: 0;
                            min-height: 0;
                            width: 100%
                            }</style></head><body><h2 id="home"><a href="./index.html">home</a></h2>
<p><em>author: niplav, created: 2019-04-24, modified: 2023-06-22, language: english, status: finished, importance: 4, confidence: possible</em></p>
<blockquote>
<p><strong><a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">Pipelines</a> are an
integral part of the Unix operating system. They come in different
variants (<a href="https://en.wikipedia.org/wiki/Named_pipe">FIFOs</a> and <a href="https://en.wikipedia.org/wiki/Anonymous_pipe">anonymous
pipes</a>) and have many
applications. Here I show how to abuse simple text files and unnamed
pipes to create cycles of data flow.</strong></p>
</blockquote><div class="toc"><div class="toc-title">Contents</div><ul><li><a href="#The_Basic_Idea">The Basic Idea</a><ul></ul></li><li><a href="#Examples">Examples</a><ul><li><a href="#Fill_Disk">Fill Disk</a><ul></ul></li><li><a href="#Stop_Ring">Stop Ring</a><ul></ul></li><li><a href="#MU">MU</a><ul></ul></li><li><a href="#Crawl_a_Website">Crawl a Website</a><ul></ul></li><li><a href="#Hashes_of_Hashes">Hashes of Hashes</a><ul></ul></li></ul></li><li><a href="#External_Links">External Links</a><ul></ul></li></ul></div>
<h1 id="Pipe_Rings"><a class="hanchor" href="#Pipe_Rings">Pipe Rings</a></h1>
<h2 id="The_Basic_Idea"><a class="hanchor" href="#The_Basic_Idea">The Basic Idea</a></h2>
<p>A pipe ring has the following structure:</p>
<pre><code>$ echo init &gt;a
$ tail -f a | [filters] &gt;&gt;a
</code></pre>
<p>Usually, <code>a</code> contains some initialization values. These initialization
values are then written into the pipeline, transformed by the filters,
and concatenated to the file. <code>tail -f</code> then reads those new lines from
the file in the order that they were generated, and new data is produced
by the filters.</p>
<h2 id="Examples"><a class="hanchor" href="#Examples">Examples</a></h2>
<h3 id="Fill_Disk"><a class="hanchor" href="#Fill_Disk">Fill Disk</a></h3>
<p>The simplest pipe ring uses no filters at all:</p>
<pre><code>$ echo test &gt;a
$ tail -f a &gt;&gt;a
</code></pre>
<p>It simply fills the disk with a file containing the line "test".</p>
<h3 id="Stop_Ring"><a class="hanchor" href="#Stop_Ring">Stop Ring</a></h3>
<p>To stop the unconstrained use of hard disk memory, one can use sed:</p>
<pre><code>$ echo test &gt;a
$ tail -f a | stdbuf -oL sed '100q' &gt;&gt;a
$ wc -l a
101
</code></pre>
<p><code>stdbuf</code> is needed because on most system, the byte streams flowing through
pipes are buffered. This means that if the command is <code>tail -f a | sed
'100q' &gt;&gt;a</code> instead, sed consumes all input, writes to the buffered
output (which has usually a size greater than the length of the line,
on my system it is <code>#define BUFSIZ 1024</code>). <code>bufsiz</code> sets the output to line
mode, which allows the <code>sed</code> output to be propagated without delay.</p>
<h3 id="MU"><a class="hanchor" href="#MU">MU</a></h3>
<p>In his book “Gödel, Escher, Bach: An Eternal Golden Braid” Douglas
Hofstadter describes a logical system called MU:</p>
<blockquote>
<p>The first thing to say about our formal system—the MIU-system –
is that it utilizes only three letters of the alphabet: M, I, U. That
means that the only strings of the MIU- system are strings which are
composed of those three letters.</p>
</blockquote>
<p><em>— <a href="https://en.wikipedia.org/wiki/Douglas_Hofstadter">Douglas Hofstadter</a>, <a href="./doc/cs/the_mu_puzzle_hofstadter_1994.pdf">“The MU-puzzle“ in “Gödel, Escher, Bach: An Eternal Golden Braid”</a> p. 1, 1994</em></p>
<p>There is a starting string, and four rules to modify this string:</p>
<blockquote>
<p>RULE I: If you possess a string whose last letter is I, you can add on a U at the end.</p>
<p>By the way, if up to this point you had not guessed it, a fact about the
meaning of "string" is that the letters are in a fixed order. For example,
MI and IM are two different strings. A string of symbols is not just a
"bag" of symbols, in which the order doesn't make any difference.
  Here is the second rule:</p>
<p>RULE II: Suppose you have Mx. Then you may add Mxx to your collection.</p>
<p>What I mean by this is shown below, in a few examples.</p>
<p>From MIU, you may get MIUIU.<br>
From MUM, you may get MUMUM.<br>
From MU, you may get MUU.</p>
<p>So the letter 'x' in the rule simply stands for any string; but once
you have decided which string it stands for, you have to stick with your
choice (until you use the rule again, at which point you may make a new
choice). Notice the third example above. It shows how, once you possess
MU, you can add another string to your collection; but you have to get
MU first! I want to add one last comment about the letter 'x': it is
not part of the formal system in the same way as the three letters 'M',
'I', and 'U' are. It is useful for us, though, to have some way to talk
in general about strings of the system, symbolically-and that is the
function of the 'x': to stand for an arbitrary string. If you ever add
a string containing an 'x' to your "collection", you have done something
wrong, because strings of the MIU-system never contain "x" “s”!
Here is the third rule:</p>
<p>RULE III: If III occurs in one of the strings in your collection, you
may make a new string with U in place of III.</p>
<p>Examples:</p>
<p>From UMIIIMU, you could make UMUMU.<br>
From MIIII, you could make MIU (also MUI).<br>
From IIMII, you can't get anywhere using this rule.<br>
(The three I's have to be consecutive.)<br>
From MIII, make MU.  </p>
</blockquote>
<p><em>— <a href="https://en.wikipedia.org/wiki/Douglas_Hofstadter">Douglas Hofstadter</a>, <a href="./doc/cs/the_mu_puzzle_hofstadter_1994.pdf">“The MU-puzzle“ in “Gödel, Escher, Bach: An Eternal Golden Braid”</a> p. 2, 1994</em></p>
<p>Hofstadter poses a challenge: starting with the string "mi", he asks
whether the string "mu" can be constructed.</p>
<p>An <a href="https://en.wikipedia.org/wiki/AWK">awk</a> script implements the
four rules:</p>
<pre><code>/i$/ { print($0 "u") }
/^m/ { s=substr($0, 2); print("m" s s) }
/iii/ { i=split($0, a, "iii")-1; for(c=1; c&lt;=i; c++) print(gensub("iii", "uu", c)) }
/uu/ { i=split($0, a, "uu")-1; for(c=1; c&lt;=i; c++) print(gensub("uu", "", c)) }
</code></pre>
<p>One can now write an <a href="https://en.wikipedia.org/wiki/Rc">rc</a> script to
implement a pipe ring that generates mu expressions.</p>
<pre><code>#!/usr/bin/env rc

fn apr{
    stdbuf -oL awk '/i$/ { print($0 "u") }
        /^m/ { s=substr($0, 2); print("m" s s); }
        /iii/ { i=split($0, a, "iii")-1; for(c=1; c&lt;=i; c++) print(gensub("iii", "uu", c)) }
        /uu/ { i=split($0, a, "uu")-1; for(c=1; c&lt;=i; c++) print(gensub("uu", "", c)) }'
}

tail -f mu | apr | stdbuf -oL grep -E '^.{,80}$' | stdbuf -oL awk '!a[$0]++' &gt;&gt;mu
</code></pre>
<p><code>awk '!a[$0]++'</code> is taken from
<a href="https://iridakos.com/how-to/2019/05/16/remove-duplicate-lines-preserving-order-linux.html">iridakos 2019</a>
and filters out duplicate lines.
Also, stdbuf doesn't work with rc functions, so it has to be written
directly into the function. <code>grep</code> is used to prevent extremely long
lines from forming through the repeated application of the first rule.</p>
<p>Executing the script gives the desired result:</p>
<pre><code>$ echo 'mi' &gt;mu
$ ./muring
^C
$ # after waiting for half a minute
$ head mu
mi
miu
mii
miuiu
miiu
miiii
miuiuiuiu
miiuiiu
miiiiu
miiiiiiii
$ grep '^mu$' mu
$ # nothing there
</code></pre>
<p>This of course does not solve the puzzle posed by Hofstadter, after all,
there could be a longer and more complex derivation that takes more time
to generate. But in either case, one can rule out a simple and short
derivation of "mu" from "mi".</p>
<h3 id="Crawl_a_Website"><a class="hanchor" href="#Crawl_a_Website">Crawl a Website</a></h3>
<p>This also works for creating a list of links that start from a given
web page (albeit only partially and not completely reliably).</p>
<p>The code for this is quite straightforward:</p>
<pre><code>#!/usr/bin/env rc

# download a web page and extract all links in it
fn getl {
    while(true)
    {
        curl `{read} |
        grep -o '&lt;a href="[^"]*"' |
        sed 's/^&lt;a href="//;s/"$//' |
        grep '^https\?://'
    }
}

tail -f links | getl | stdbuf -i0 -oL awk '!a[$0]++' &gt;&gt;links
</code></pre>
<p>This code should be understandable: The file links contains the starting
web page to be crawled. This is then <code>curl</code>ed and all outgoing links
are extracted with a sequence of filtering out non-links using <code>grep</code>
and <code>sed</code>. The results are then filtered for results that were already
obtained, and appended to the links file again–an elegant demonstration
of a pipe ring.</p>
<pre><code>$ echo https://en.wikipedia.org/wiki/Main_Page &gt;links
$ ./crawler
^C
$ tail links
https://en.wikipedia.org/wiki/Main_Page
https://lists.wikimedia.org/mailman/listinfo/daily-article-l
https://wikimediafoundation.org/our-work/wikimedia-projects/
https://commons.wikimedia.org/wiki/
https://www.mediawiki.org/wiki/
https://meta.wikimedia.org/wiki/
https://en.wikibooks.org/wiki/
https://www.wikidata.org/wiki/
https://en.wikinews.org/wiki/
https://en.wikiquote.org/wiki/
</code></pre>
<h3 id="Hashes_of_Hashes"><a class="hanchor" href="#Hashes_of_Hashes">Hashes of Hashes</a></h3>
<p>To use a more superfluous and fun example, one can think of hexadecimal
strings of a certain length as being closed under a given hash
function. For example, the set of the hexadecimal strings of length 32 is
closed under the <a href="https://en.wikipedia.org/wiki/MD5">MD5 hash sum</a>. That
means that applying a hash function to an element of this set results
in the member of a set.</p>
<p>The probability that there exists a hexadecimal string of
length 32 that is it's own MD5 hash sum is approximately
<span class="mjpage"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.02ex" height="3.343ex" style="vertical-align: -1.005ex;" viewBox="0 -1006.6 5605.9 1439.2" role="img" focusable="false" xmlns="http://www.w3.org/2000/svg" aria-labelledby="MathJax-SVG-1-Title">
<title id="MathJax-SVG-1-Title">1-\frac{1}{e}≈63\%</title>
<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)" aria-hidden="true">
 <use xlink:href="#MJMAIN-31" x="0" y="0"></use>
 <use xlink:href="#MJMAIN-2212" x="722" y="0"></use>
<g transform="translate(1501,0)">
<g transform="translate(342,0)">
<rect stroke="none" width="473" height="60" x="0" y="220"></rect>
 <use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="84" y="629"></use>
 <use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="101" y="-488"></use>
</g>
</g>
 <use xlink:href="#MJMAIN-2248" x="2715" y="0"></use>
<g transform="translate(3771,0)">
 <use xlink:href="#MJMAIN-36"></use>
 <use xlink:href="#MJMAIN-33" x="500" y="0"></use>
</g>
 <use xlink:href="#MJMAIN-25" x="4772" y="0"></use>
</g>
</svg></span> (see <a href="https://stackoverflow.com/questions/235785/is-there-an-md5-fixed-point-where-md5x-x">this stackoverflow
question</a>).</p>
<p>This can be illustrated easily with a toy example: the set of hexadecimal
strings with length 2, and a hash sum that is simply the first two
characters of the MD5 sum of the input (here called f2md5sum). Then one
can try to find such a fixed point with a line of rc:</p>
<pre><code>$ for(i in `{seq 0 255 | awk '{ printf("%.2x\n", $0) }'}) { j=`{echo $i | md5sum | grep -o '^..'}; if(~ $i $j) echo $i $j }
6b 6b
$ md5sum
6b
6bf60475e53919fb39d07c0bb66c9c6e  -
</code></pre>
<p>Since there are of course collisions in this simple hash function, it
is very likely that for the set H of hexadecimal strings of length 2,
there will be some elements h∈H so that there is no element v∈H so
that f2md5sum(v)=h.</p>
<p>But there are cycles for this set and operation: sequences of strings
h₁,h₂,h₃,…,hₙ so that f2md5sum(h₁)=h₂, f2md5sum(h₂)=h₃,
…, f2md5sum(hₙ)=h₁. One can find such cycles by writing a little
script using a pipe ring:</p>
<pre><code>#!/usr/bin/env rc

fn oipl {
    while(read | eval $*) {}
}

tail -f sums | oipl md5sum | stdbuf -i0 -oL grep -o '^..' &gt;&gt;sums
</code></pre>
<p>It gives the desired results:</p>
<pre><code>$ echo 6b &gt;sums
$ ./hashring
$ head sums
6b
6b
6b
6b
6b
6b
6b
6b
6b
6b
$ echo cc &gt;sums
$ ./hashring
$ head -50 sums
cc
87
07
30
d5
16
5b
05
b1
08
43
f0
92
ed
4b
71
72
8f
ad
33
4f
aa
d4
8b
e4
0a
87
07
</code></pre>
<p>In the last example, one can see such a cycle starting with 87 and ending
with 0a, as well as a collision: cc and 0a both have the hash 87.</p>
<p>Theoretically, one could use this method to find cycles for longer
hash sums, and while it would be interesting to find a string that is it's
own <a href="https://en.wikipedia.org/wiki/SHA-1">SHA1 sum</a>, actually doing it
seems like a frivolous waste of energy and computing power.</p>
<p>Fortunately for me, somebody else has done this already,
creating a gif that displays its own MD5 sum (made by
<a href="http://nitter.poast.org/__spq__/status/838583044260904960">spq</a>):</p>
<p><img alt="A gif that displays its own MD5 sum" src="./img/pipe_rings/md5.gif" title="A gif that displays its own MD5 sum. The MD5 sum is F5CA4F935D44685C431A8BF788C0EACA."></p>
<h2 id="External_Links"><a class="hanchor" href="#External_Links">External Links</a></h2>
<ul>
<li><a href="https://www2.dmst.aueb.gr/dds/sw/dgsh/">dgsh—directed graph shell</a></li>
</ul>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs id="MathJax_SVG_glyphs"><path stroke-width="1" id="MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="MJMAIN-2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path><path stroke-width="1" id="MJMAIN-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path stroke-width="1" id="MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="1" id="MJMAIN-25" d="M465 605Q428 605 394 614T340 632T319 641Q332 608 332 548Q332 458 293 403T202 347Q145 347 101 402T56 548Q56 637 101 693T202 750Q241 750 272 719Q359 642 464 642Q580 642 650 732Q662 748 668 749Q670 750 673 750Q682 750 688 743T693 726Q178 -47 170 -52Q166 -56 160 -56Q147 -56 142 -45Q137 -36 142 -27Q143 -24 363 304Q469 462 525 546T581 630Q528 605 465 605ZM207 385Q235 385 263 427T292 548Q292 617 267 664T200 712Q193 712 186 709T167 698T147 668T134 615Q132 595 132 548V527Q132 436 165 403Q183 385 203 385H207ZM500 146Q500 234 544 290T647 347Q699 347 737 292T776 146T737 0T646 -56Q590 -56 545 0T500 146ZM651 -18Q679 -18 707 24T736 146Q736 215 711 262T644 309Q637 309 630 306T611 295T591 265T578 212Q577 200 577 146V124Q577 -18 647 -18H651Z"></path></defs></svg></body></html>